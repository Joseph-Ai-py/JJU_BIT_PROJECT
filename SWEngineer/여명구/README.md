## 1. PDF 파일을 읽어오는 방식 최적화
- **이전 코드**: 파일에 대한 질문을 할 때마다 PDF 파일을 다시 읽고 처리함.
- **수정 코드**:
  - `@st.cache_resource`를 사용하여 PDF 파일의 해시 값을 계산하고, 파일이 변경되지 않으면 기존 데이터를 재사용하도록 수정함.
  - `calculate_file_hash(filepath)` 함수를 추가하여 파일의 MD5 해시 값을 계산하고, 이를 기준으로 캐시 상태를 관리.


## 2. PDF 처리 및 벡터 데이터베이스 생성 함수 통합
- **이전 코드**: PDF 파일 처리와 벡터 데이터베이스 생성이 분리되어 있음.
- **수정 코드**:
  - `process_pdf_and_create_db(pdf_filepath)` 함수를 추가하여 PDF 처리와 벡터 데이터베이스 생성을 하나의 함수로 통합.
  - PDF 처리 및 데이터베이스 생성 과정의 중복 작업을 방지.


## 3. Streamlit 세션 상태 관리 추가
- **이전 코드**: 글로벌 변수 `global_db`와 `mmr_docs_cache`를 사용하여 데이터베이스와 검색 결과를 관리.
- **수정 코드**:
  - Streamlit의 `st.session_state`를 활용하여 데이터베이스와 파일 해시 값을 관리.
  - `st.session_state["db"]`와 `st.session_state["file_hash"]`를 통해 데이터베이스와 파일 상태를 저장하고 재사용.


## 4. 파일 처리 시 캐싱 도입
- **수정 코드**:
  - Streamlit의 `@st.cache_resource` 데코레이터를 활용하여 PDF 파일 처리 결과를 캐싱.
  - 동일한 파일이 업로드되었을 경우 처리 속도를 대폭 향상시킴.


## 5. 불필요한 글로벌 변수 제거
- **이전 코드**: `global_db`와 `mmr_docs_cache`를 사용하여 전역 상태를 관리.
- **수정 코드**:
  - 글로벌 변수를 제거하고, Streamlit의 세션 상태 관리 기능으로 대체.


## 6. 파일 업로드 및 데이터베이스 생성 과정 개선
- **수정 코드**:
  - 파일 업로드 후 `calculate_file_hash`를 통해 파일 해시 값을 계산.
  - 동일한 해시 값일 경우 기존 데이터베이스를 재사용.


## 7. 코드 구조 개선
- **수정 코드**:
  - PDF 파일 처리 및 데이터베이스 생성 과정을 하나의 함수로 통합하여 코드 가독성을 향상.
  - `main_streamlit` 함수 내부의 로직을 간결하게 재구성.


## 결과적으로 달라진 점
- **효율성 증가**: 동일한 파일을 반복적으로 업로드해도 다시 처리하지 않아 처리 시간이 단축됨.
- **코드 유지보수성 향상**: 글로벌 변수 사용을 제거하고 Streamlit 세션 상태를 활용하여 관리.
- **사용자 경험 개선**: 파일 처리 속도가 빨라지고, 불필요한 중복 작업이 제거됨.